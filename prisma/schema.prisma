generator client {
  provider = "prisma-client-js"
  output   = "./generated/client"
}

datasource db {
  provider = "postgresql"
}

model Admin {
  id       Int    @id @default(autoincrement())
  name     String
  email    String @unique
  password String
  contact  String
}

model Approver {
  id       Int    @id @default(autoincrement())
  name     String
  email    String @unique
  password String
}

model Pengawas {
  id       Int    @id @default(autoincrement())
  name     String
  email    String @unique
  password String
}

model User {
  id               String  @id @default(uuid())
  name             String?
  contact          String?
  email            String? @unique
  ktpNum           String? @unique @db.Char(16)  
  emergencyName    String? @db.VarChar(255)     
  emergencyContact String? @unique @db.VarChar(255)
  
  // OUT RELATION
  jenazah         Jenazah?
  penanggungJawab PenanggungJawab?
}

model PenanggungJawab {
  id            String  @id @default(uuid())
  
  // RELATION ID
  userId        String? @unique
  
  // IN RELATION
  user        User?        @relation(fields: [userId], references: [id])
  makam       Makam[]       @relation("PJ_Makam")
  makamStatus MakamStatus[] @relation("PJ_MakamStatus")
}

model Jenazah {
  id                              String    @id @default(uuid())
  tanggalPemakaman                DateTime?
  statusJenazah                   String?   @db.VarChar(255)
  masaAktif                       DateTime?
  statusPembayaranPesanan         String?   @db.VarChar(255)
  statusPembayaranIuranTahunan    String?   @db.VarChar(255)

  // RELATION ID
  userId  String? @unique
  blokId  String?  
  
  // IN RELATION
  user  User? @relation(fields: [userId], references: [id])
  blok  Blok? @relation(fields: [blokId], references: [id])

  // OUT RELATION
  makam       Makam?
  makamStatus MakamStatus?
}

model Blok {
  id                       String    @id @default(uuid())
  lokasi                   String?   @db.VarChar(255)
  tanggalPemakamanTerakhir DateTime?
  statusBlok               String?   @db.VarChar(255)
  statusPesanan            String?   @db.VarChar(255)
  availability             String?   @db.VarChar(255)
  
  // OUT RELATION
  jenazah     Jenazah[]
  makam       Makam[]
  makamStatus MakamStatus[]
}

// Makam Sedang Dipesan
model MakamStatus {
  id                    String    @id @default(uuid())
  nama                  String?
  silsilah              String?
  description           String?
  createdAt             DateTime? @default(now()) @db.Timestamp(6)
  updatedAt             DateTime? @default(now()) @updatedAt @db.Timestamp(6)
  tanggalPemesanan      DateTime?

  // RELATION ID
  jenazahId String? @unique
  blokId    String? 
  
  // IN RELATION
  jenazah Jenazah? @relation(fields: [jenazahId], references: [id])
  blok    Blok?    @relation(fields: [blokId], references: [id])

  // OUT RELATION
  pj PenanggungJawab[] @relation("PJ_MakamStatus")
}

// Makam Aktif
model Makam {
  id                    String    @id @default(uuid())
  nama                  String?
  silsilah              String?
  description           String?
  createdAt             DateTime? @default(now()) @db.Timestamp(6)
  updatedAt             DateTime? @default(now()) @updatedAt @db.Timestamp(6)
  tanggalPemesanan      DateTime?

  // RELATION ID
  jenazahId String? @unique
  blokId    String? 
  
  // IN RELATION
  jenazah Jenazah? @relation(fields: [jenazahId], references: [id])
  blok    Blok?    @relation(fields: [blokId], references: [id])

  // OUT RELATION
  pj PenanggungJawab[] @relation("PJ_Makam")
}